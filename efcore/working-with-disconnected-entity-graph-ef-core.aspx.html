


<!DOCTYPE html>

<html>
<head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=EDGE;chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>
	Working with Disconnected Entity Graph in Entity Framework Core
</title><link href="../App_Themes/bs/bootstrap.min.css" rel="stylesheet" /><link href="http://www.entityframeworktutorial.net/App_Themes/css/eftstyle.min.css?v=1.9" rel="stylesheet" type="text/css" />
    

    <!--[if lt IE 9]>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="icon" href="../favicon.ico" type="image/x-icon" />
    <meta id="ctl00_head_metaKeyword" name="keywords" content="track disconnected entity graph, save disconnected entity graph in ef core attach, entry, add, update,remove, methods to change entity state,how to, entity framework,Entity Framework core tutorial,efcore Tutorial,ef, ef core, entity framework"></meta>
    <meta name="description" content="Learn how different methods changes entity state of each entity in an entity graph in entity framework core in disconnected scenario." />
<script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.entityframeworktutorial.net/efcore/working-with-disconnected-entity-graph-ef-core.aspx"},"headline":"Working with Disconnected Entity Graph in Entity Framework Core","author":{"@type":"Person","name":"Ravi Karia","sameAs":["https://www.entityframeworktutorial.net/aboutme.aspx","https://www.linkedin.com/in/ravikaria"]},"dateModified":"2021-06-26T15:27:49.3389770Z","description":"Learn how different methods changes entity state of each entity in an entity graph in entity framework core in disconnected scenario."}</script>
    <link rel="canonical" href="https://www.entityframeworktutorial.net/efcore/working-with-disconnected-entity-graph-ef-core.aspx" />

    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-33844821-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-33844821-1');
    </script>
    <!-- InMobi Choice. Consent Manager Tag v3.0 (for TCF 2.2) -->
<script type="text/javascript" async=true>
    (function () {
        var host = "www.themoneytizer.com";
        var element = document.createElement('script');
        var firstScript = document.getElementsByTagName('script')[0];
        var url = 'https://cmp.inmobi.com'
            .concat('/choice/', '6Fv0cGNfc_bw8', '/', host, '/choice.js?tag_version=V3');
        var uspTries = 0;
        var uspTriesLimit = 3;
        element.async = true;
        element.type = 'text/javascript';
        element.src = url;

        firstScript.parentNode.insertBefore(element, firstScript);

        function makeStub() {
            var TCF_LOCATOR_NAME = '__tcfapiLocator';
            var queue = [];
            var win = window;
            var cmpFrame;

            function addFrame() {
                var doc = win.document;
                var otherCMP = !!(win.frames[TCF_LOCATOR_NAME]);

                if (!otherCMP) {
                    if (doc.body) {
                        var iframe = doc.createElement('iframe');

                        iframe.style.cssText = 'display:none';
                        iframe.name = TCF_LOCATOR_NAME;
                        doc.body.appendChild(iframe);
                    } else {
                        setTimeout(addFrame, 5);
                    }
                }
                return !otherCMP;
            }

            function tcfAPIHandler() {
                var gdprApplies;
                var args = arguments;

                if (!args.length) {
                    return queue;
                } else if (args[0] === 'setGdprApplies') {
                    if (
                        args.length > 3 &&
                        args[2] === 2 &&
                        typeof args[3] === 'boolean'
                    ) {
                        gdprApplies = args[3];
                        if (typeof args[2] === 'function') {
                            args[2]('set', true);
                        }
                    }
                } else if (args[0] === 'ping') {
                    var retr = {
                        gdprApplies: gdprApplies,
                        cmpLoaded: false,
                        cmpStatus: 'stub'
                    };

                    if (typeof args[2] === 'function') {
                        args[2](retr);
                    }
                } else {
                    if (args[0] === 'init' && typeof args[3] === 'object') {
                        args[3] = Object.assign(args[3], { tag_version: 'V3' });
                    }
                    queue.push(args);
                }
            }

            function postMessageEventHandler(event) {
                var msgIsString = typeof event.data === 'string';
                var json = {};

                try {
                    if (msgIsString) {
                        json = JSON.parse(event.data);
                    } else {
                        json = event.data;
                    }
                } catch (ignore) { }

                var payload = json.__tcfapiCall;

                if (payload) {
                    window.__tcfapi(
                        payload.command,
                        payload.version,
                        function (retValue, success) {
                            var returnMsg = {
                                __tcfapiReturn: {
                                    returnValue: retValue,
                                    success: success,
                                    callId: payload.callId
                                }
                            };
                            if (msgIsString) {
                                returnMsg = JSON.stringify(returnMsg);
                            }
                            if (event && event.source && event.source.postMessage) {
                                event.source.postMessage(returnMsg, '*');
                            }
                        },
                        payload.parameter
                    );
                }
            }

            while (win) {
                try {
                    if (win.frames[TCF_LOCATOR_NAME]) {
                        cmpFrame = win;
                        break;
                    }
                } catch (ignore) { }

                if (win === window.top) {
                    break;
                }
                win = win.parent;
            }
            if (!cmpFrame) {
                addFrame();
                win.__tcfapi = tcfAPIHandler;
                win.addEventListener('message', postMessageEventHandler, false);
            }
        };

        makeStub();

        var uspStubFunction = function () {
            var arg = arguments;
            if (typeof window.__uspapi !== uspStubFunction) {
                setTimeout(function () {
                    if (typeof window.__uspapi !== 'undefined') {
                        window.__uspapi.apply(window.__uspapi, arg);
                    }
                }, 500);
            }
        };

        var checkIfUspIsReady = function () {
            uspTries++;
            if (window.__uspapi === uspStubFunction && uspTries < uspTriesLimit) {
                console.warn('USP is not accessible');
            } else {
                clearInterval(uspInterval);
            }
        };

        if (typeof window.__uspapi === 'undefined') {
            window.__uspapi = uspStubFunction;
            var uspInterval = setInterval(checkIfUspIsReady, 6000);
        }
    })();
</script>
<!-- End InMobi Choice. Consent Manager Tag v3.0 (for TCF 2.2) -->
</head>
<body>

    <div class="phWrapper">
        

<header class="phHeader">
    <nav class="navbar navbar-expand logo-link">
        <a class="navbar-brand text-uppercase" href="../index.html">
            <img src="../images/logo.png" class="logo-img" alt="Entity Framework Tutorial" /></a>
    </nav>
</header>

        
        <nav class="navbar navbar-expand navbar-dark special-color-dark topMenuHorizontal sticky-top">

            <!-- Navbar brand -->
            <!-- Collapse button -->
            <button class="navbar-toggler d-block d-md-none" type="button" data-toggle="collapse" data-target="#navbarLeft" aria-controls="#navbarLeft"
                aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Collapsible content -->
            <div class="collapse navbar-collapse" id="topMenu">

                <!-- Links -->
                <ul class="navbar-nav mr-auto left">
                    <li class="nav-item">
                        <a href="../index.html" class="nav-link" style="font-size: 20px">
                            <i class="fa fa-home" aria-hidden="true"></i>
                        </a>
                    </li>

                    <li class="nav-item"><a class="nav-link" href="../what-is-entityframework.aspx.html">EF Basics</a></li>
                    <li class="nav-item"><a class="nav-link" href="entity-framework-core.aspx.html">EF Core</a></li>
                    <li class="nav-item"><a class="nav-link" href="../entityframework6/introduction.aspx.html">EF 6 DB-First</a></li>
                    <li class="nav-item"><a class="nav-link" href="../code-first/what-is-code-first.aspx.html">EF 6 Code-First </a></li>
                    <li class="nav-item"><a class="nav-link" href="../faq.aspx.html">FAQs</a></li>
                    <li class="nav-item"><a class="nav-link" href="../entity-framework-quiz.aspx.html">EF Quiz</a></li>
                    <li class="nav-item"><a class="nav-link" href="../entity-framework-cheat-sheet.aspx.html">Cheat Sheet</a></li>
                    <li class="nav-item dropdown mega-dropdown d-lg-none d-md-block">
                <a class="nav-link dropdown-toggle no-caret" id="navbarDropdownMenuLink1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More</a>
                <div class="dropdown-menu mega-menu v-2 row z-depth-1 special-color" aria-labelledby="navbarDropdownMenuLink1">
                    <a class="close text-white">&#10005; </a>
                    <div class="row mx-md-4 mx-1">
                        <div class="col-md-6 col-sm-6 col-xl-3 sub-menu my-xl-4 mt-4 mb-4">
                            <h6 class="sub-title text-white">Entity Framework Tutorials</h6>
                            <ul class="caret-style pl-0">
                                <li class=""><a class="menu-item" href="entity-framework-core.aspx.html">EF Core</a></li>
                                <li class=""><a class="menu-item" href="../code-first/what-is-code-first.aspx.html">EF 6 Code-First</a></li>
                                <li class=""><a class="menu-item" href="../entityframework6/introduction.aspx.html">EF 6 DB-First</a></li>
                            </ul>
                        </div>
                        <div class="col-md-6 col-sm-6 col-xl-3 sub-menu my-xl-4  mt-4 ">
                            <h6 class="sub-title text-white">Entity Framework</h6>
                            <!--Featured image-->
                            <ul class="caret-style pl-0">
                                <li class=""><a class="menu-item" href="../entity-framework-quiz.aspx.html">EF Quiz</a></li>
                                <li class=""><a class="menu-item" href="http://www.entityframeworktutorial.net/Articles/entityframework-articles.aspx">FAQs</a></li>
                                
                                <li class=""><a class="menu-item" href="../entity-framework-cheat-sheet.aspx.html">EF Cheat Sheet</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </li>
                </ul>

                <!-- Links -->
                <ul class="navbar-nav nav-flex right ml-auto">
                    
                </ul>
                <!-- Search form -->
                <div id="wrap">
                    <form class="navbar-form" action="https://www.google.com/search" id="cse-search-box" role="search" target="_blank">
                        <div>
                            <input type="hidden" name="cx" value="partner-pub-7448309248176309:8374077199" />
                            <input type="hidden" name="ie" value="UTF-8" />
                            <input type="text" name="q" id="q" placeholder="Search" class="form-control">
                            <span class="input-group-btn">
                                <button type="submit" id="search_submit" class="button-search border-0 bg-transparent text-white">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                        </div>
                    </form>

                </div>
            </div>
        </nav>

        
        <nav class="navbar menuLeft p-0 navbar-expand-md">
            <div class="collapse navbar-collapse" id="navbarLeft">
                <div class="menuVerticalParent">
                    <ul class="menuVertical" id="leftmenu">
                        <li><a href="entity-framework-core.aspx.html">EF Core - Introduction</a></li>
                        <li><a href="install-entity-framework-core.aspx.html">EF Core - Installation</a></li>
                        <li><a href="create-entities.aspx.html">EF Core - Create Entities</a></li>
                        <li><a href="entity-framework-core-dbcontext.aspx.html">EF Core - Create DbContext</a></li>
                        <li>
                            <ul>
                                <li><a href="entity-framework-core-console-application.aspx.html">Working with DbContext</a></li>
                                <li><a href="changetracker-in-ef-core.aspx.html">Track Changes of Entities</a></li>
                                <li><a href="db-connection-strings.aspx.html">DB Connection Strings</a></li>
                            </ul>
                        </li>
                        <li><a href="entity-framework-core-migration.aspx.html">EF Core - Migrations</a></li>
                        <li>
                            <ul>
                                <li><a href="generate-sql-script.aspx.html">Generate SQL Script</a></li>
                                <li><a href="pmc-commands-for-ef-core-migration.aspx.html">PMC/PowerShell Commands</a></li>
                                <li><a href="cli-commands-for-ef-core-migration.aspx.html">.NET Core CLI Commands</a></li>
                            </ul>
                        </li>
                        <li><a href="saving-data-in-connected-scenario-in-ef-core.aspx.html">EF Core - Saving Data</a></li>
                        <li><a href="querying-in-ef-core.aspx.html">EF Core - Querying</a></li>
                        <li><a href="saving-data-in-disconnected-scenario-in-ef-core.aspx.html">Disconnected Scenario: Insert Data</a></li>
                        <li>
                            <ul>
                                <li><a href="update-data-in-entity-framework-core.aspx.html">Update Data</a></li>
                                <li><a href="delete-data-in-entity-framework-core.aspx.html">Delete Data</a></li>
                            </ul>
                        </li>


                        <li><a href="conventions-in-ef-core.aspx.html">EF Core - Conventions</a></li>
                        <li>
                            <ul>
                                <li><a href="one-to-many-conventions-entity-framework-core.aspx.html">One-to-Many Conventions</a></li>
                                <li><a href="one-to-one-conventions-entity-framework-core.aspx.html">One-to-One Conventions</a></li>
                            </ul>
                        </li>
                        <li><a href="configuration-in-entity-framework-core.aspx.html">EF Core - Configurations</a></li>
                        <li><a href="fluent-api-in-entity-framework-core.aspx.html">EF Core - Fluent API</a>

                        </li>
                        <li>
                            <ul>
                                <li><a href="configure-one-to-many-relationship-using-fluent-api-in-ef-core.aspx.html">Configure One-to-Many Relationship</a></li>
                                <li><a href="configure-one-to-one-relationship-using-fluent-api-in-ef-core.aspx.html">Configure One-to-One Relationship</a></li>
                                <li><a href="configure-many-to-many-relationship-in-ef-core.aspx.html">Configure Many-to-Many Relationship</a></li>

                            </ul>
                        </li>

                        <li><a href="shadow-property.aspx.html">Shadow Property</a></li>
                        <li><a href="working-with-disconnected-entity-graph-ef-core.aspx.html">Working with Disconnected Entity Graph</a></li>
                        <li><a href="changetracker-trackgraph-ef-core.aspx.html">Tracking Entity Graph</a></li>
                        <li><a href="raw-sql-queries-in-ef-core.aspx.html">Raw SQL Queries</a></li>
                        <li><a href="working-with-stored-procedure-in-ef-core.aspx.html">Working with Stored Procedure</a></li>
                        <li><a href="logging-in-entityframework-core.aspx.html">Logging</a></li>

                        <li><a href="create-model-for-existing-database-in-ef-core.aspx.html">EF Core - Existing Database</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <section class="middleContent" id="middleContent">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12 pr-md-0 col-lg-12 col-xl-8">
                        
<div class="lb-ad mt-1">
    
    <a href="https://entityframework-extensions.net?z=eft" target="_blank" rel="nofollow" >
        <img src="http://www.entityframeworktutorial.net/images/ef-ext-lb.jpg" class="eftext-img" /></a>
</div>


                        
<div class="navigation ">
    <div class="row">
        <div class="col-6  text-left mb-2 mb-sm-0" id="divPrev1">
            <a id="ctl00_eftNextPrevious_lnkPrev1" class="btn  rounded-0" href="shadow-property.aspx.html"><i class="fa fa-angle-left mr-1"></i> Previous</a>
        </div>
        <div class="col-6 text-right float-right" id="divNext1">
            <a id="ctl00_eftNextPrevious_lnkNext1" class="btn rounded-0" href="changetracker-trackgraph-ef-core.aspx.html">Next <i class="fa fa-angle-right ml-1"></i></a>
        </div>
    </div>
</div>


                        
    <h1>Working with Disconnected Entity Graph in Entity Framework Core</h1>
    <p>
        In the previous chapter, you learned how the <code>ChangeTracker</code> automatically changes the <code>EntityState</code> of each entity in the connected scenario.
        Here, you will learn about the behaviours of different methods on the root entity and child entities of the disconnected entity graph in Entity Framework Core.
    </p>

    <p>
        Entity Framework Core provides the following different methods, which not only attach an entity to a context, but also change the <code>EntityState</code> of each entity in a disconnected entity graph:
    </p>

    <ul class='list'>
        <li>Attach()
        </li>
        <li>Entry()
        </li>
        <li>Add()
        </li>
        <li>Update()
        </li>
        <li>Remove()
        </li>
    </ul>

    <p>
        Let's see how the above methods change the <code>EntityState</code> of each entity in an entity graph in Entity Framework Core 2.x.
    </p>

    <h2 id="attach-ef-core">Attach()</h2>

    <p>
        The <code>DbContext.Attach()</code> and <code>DbSet.Attach()</code> methods attach the specified disconnected entity graph and start tracking it. 
        They return an instance of <code>EntityEntry</code>, which is used to assign the appropriate <code>EntityState</code>.
    </p>

    <p>
        The following example demonstrates the behaviour of the <code>DbContext.Attach()</code> method on the <code>EntityState</code> of each entity in a graph.
    </p>

    <pre class="csharpcode">
<span class="kwrd">public static void</span> Main()
{
    <span class="kwrd">var</span> stud = <span class="kwrd">new</span> Student() { <span class="rem">//Root entity (empty key)</span>
        Name = <span class="str">"Bill"</span>,
        Address = <span class="kwrd">new</span> StudentAddress()  <span class="rem">//Child entity (with key value)</span>
        {
            StudentAddressId = 1,
            City = <span class="str">"Seattle"</span>,
            Country = <span class="str">"USA"</span>
        },
        StudentCourses = <span class="kwrd">new</span> List&lt;StudentCourse&gt;() {
            <span class="kwrd">new</span> StudentCourse(){  Course = <span class="kwrd">new</span> Course(){ CourseName = <span class="str">"Machine Language"</span> } },<span class="rem">//Child entity (empty key)</span>
            <span class="kwrd">new</span> StudentCourse(){  Course = <span class="kwrd">new</span> Course(){  CourseId = 2 } } <span class="rem">//Child entity (with key value)</span>
        }
    };

    <span class="kwrd">var</span> context = <span class="kwrd">new</span> <span class="userclass">SchoolContext</span>();
    context.Attach(stud).State = EntityState.Added;  

    DisplayStates(context.ChangeTracker.Entries());
}

<span class="kwrd">private</span> <span class="kwrd">static</span> <span class="kwrd">void</span> DisplayStates(<span class="userclass">IEnumerable</span>&lt;<span class="userclass">EntityEntry</span>&gt; entries)
{
    <span class="kwrd">foreach</span> (<span class="kwrd">var</span> entry <span class="kwrd">in</span> entries)
    {
        Console.WriteLine($<span class="str">"Entity: </span>{entry.Entity.GetType().Name},
                            <span class="str"> State: </span>{entry.State.ToString()} ");
    }
}
</pre>
    <div class="outputLabel">
        Output:
    </div>

    <samp>
        Entity: Student, State: Added               <br/>
        Entity: StudentAddress, State: Unchanged    <br/>
        Entity: StudentCourse, State: Added         <br/>
        Entity: Course, State: Added                <br/>
        Entity: StudentCourse, State: Added         <br/>
        Entity: Course, State: Unchanged            
    </samp>

    <p>
        In the above example, <code>stud</code> is an instance of the <code>Student</code> entity graph which includes references of <code>StudentAddress</code> and <code>StudentCourse</code> entities.
        <code>context.Attach(stud).State = EntityState.Added</code> attaches the <code>stud</code> entity graph to a context and sets Added state to it.
        
    </p>
    <p>The <code>Attach()</code> method sets Added <code>EntityState</code> to the root entity (in this case <code>Student</code>) irrespective of whether it contains the Key value or not. 
        If a child entity contains the key value, then it will be marked as Unchanged, otherwise it will be marked as Added. 
        The output of the above example shows that the <code>Student</code> entity has Added <code>EntityState</code>, the child entities with non-empty key values have Unchanged <code>EntityState</code> and the ones with empty key values have Added state.</p>
    <p>
        The following table lists the behaviour of the <code>Attach()</code> method when setting a different <code>EntityState</code> to a disconnected entity graph.
    </p>

    <div class="table-responsive">
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th class="col-sm-4">Attach()
                    </th>
                    <th  class="col-sm-2">Root entity with Key value
                    </th>
                    <th  class="col-sm-2">Root Entity with Empty or CLR default value
                    </th >
                    <th class="col-sm-2">Child Entity with Key value
                    </th>
                    <th class="col-sm-2">Child Entity with empty or CLR default value
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>context.Attach(entityGraph).State = EntityState.Added
                    </td>
                    <td>Added
                    </td>
                    <td>Added
                    </td>
                    <td>Unchanged
                    </td>
                    <td>Added
                    </td>
                </tr>
                <tr>
                    <td>context.Attach(entityGraph).State = EntityState.Modified
                    </td>
                    <td>Modified
                    </td>
                    <td>Exception
                    </td>
                    <td>Unchanged
                    </td>
                    <td>Added
                    </td>
                </tr>
                <tr>
                    <td>context.Attach(entityGraph).State = EntityState.Deleted
                    </td>
                    <td>Deleted
                    </td>
                    <td>Exception
                    </td>
                    <td>Unchanged
                    </td>
                    <td>Added
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    
<div class="inart-ad">
   
    
</div>

    <h2 id="entry-ef-core">Entry()</h2>

    <p>
        The <code>DbContext.Entry()</code> method behaves differently in Entity Framework Core compared with the previous EF 6.x. Consider the following example:
    </p>

    
    <pre class="csharpcode">
<span class="kwrd">var</span> student = <span class="kwrd">new</span> Student() { <span class="rem">//Root entity (empty key)</span>
    Name = <span class="str">"Bill"</span>,
    Address = <span class="kwrd">new</span> StudentAddress()  <span class="rem">//Child entity (with key value)</span>
    {
        StudentAddressId = 1,
        City = <span class="str">"Seattle"</span>,
        Country = <span class="str">"USA"</span>
    },
    StudentCourses = <span class="kwrd">new</span> List&lt;StudentCourse&gt;() {
            <span class="kwrd">new</span> StudentCourse(){  Course = <span class="kwrd">new</span> Course(){ CourseName=<span class="str">"Machine Language"</span> } },<span class="rem">//Child entity (empty key)</span>
            <span class="kwrd">new</span> StudentCourse(){  Course = <span class="kwrd">new</span> Course(){  CourseId=2 } } <span class="rem">//Child entity (with key value)</span>
        }
};

<span class="kwrd">var</span> context = <span class="kwrd">new</span> <span class="userclass">SchoolContext</span>();
context.Entry(student).State = <span class="userclass">EntityState</span>.Modified;

DisplayStates(context.ChangeTracker.Entries());
</pre>
    <div class="outputLabel">
        Output:
    </div>

    <samp>
        Entity: Student, State: Modified
    </samp>
    <p>
       In the above example, <code>context.Entry(student).State = EntityState.Modified</code> attaches an entity to a context and applies the specified <code>EntityState</code> (in this case, Modified) to the root entity, irrespective of whether it contains a Key property value or not. 
        It ignores all the child entities in a graph and does not attach or set their <code>EntityState</code>.
    </p>

    <p>
        The following table lists different behaviours of the <code>DbContext.Entry()</code> method.
    </p>

    <div class="table-responsive">
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th class="col-sm-6">Set EntityState using Entry() 
                    </th>
                    <th class="col-sm-2">Root entity with Key value
                    </th>
                    <th class="col-sm-2">Root Entity with Empty or CLR default value
                    </th>
                    <th class="col-sm-2">Child Entities with/out Key value
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>context.Entry(entityGraph).State = EntityState.Added
                    </td>
                    <td>Added
                    </td>
                    <td>Added
                    </td>
                    <td>Ignored
                    </td>
                </tr>
                <tr>
                    <td>context.Entry(entityGraph).State = EntityState.Modified
                    </td>
                    <td>Modified
                    </td>
                    <td>Modified
                    </td>
                    <td>Ignored
                    </td>
                </tr>
                <tr>
                    <td>context.Entry(entityGraph).State = EntityState.Deleted
                    </td>
                    <td>Deleted
                    </td>
                    <td>Deleted
                    </td>
                    <td>Ignored
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <h2 id="add-ef-core">Add()</h2>

    <p>
        The <code>DbContext.Add</code> and <code>DbSet.Add</code> methods attach an entity graph to a context and set Added <code>EntityState</code> to a root and child entities, irrespective of whether they have key values or not.
    </p>

<pre class="csharpcode">
<span class="kwrd">var</span> student = <span class="kwrd">new</span> Student() { <span class="rem">//Root entity (with key value)</span>
    StudentId = 1,
    Name = <span class="str">"Bill"</span>,
    Address = <span class="kwrd">new</span> StudentAddress()  <span class="rem">//Child entity (with key value)</span>
    {
        StudentAddressId = 1,
        City = <span class="str">"Seattle"</span>,
        Country = <span class="str">"USA"</span>
    },
    StudentCourses = <span class="kwrd">new</span> List&lt;StudentCourse&gt;() {
            <span class="kwrd">new</span> StudentCourse(){  Course = <span class="kwrd">new</span> Course(){ CourseName=<span class="str">"Machine Language"</span> } },<span class="rem">//Child entity (empty key)</span>
            <span class="kwrd">new</span> StudentCourse(){  Course = <span class="kwrd">new</span> Course(){  CourseId=2 } } <span class="rem">//Child entity (with key value)</span>
        }
};

<span class="kwrd">var</span> context = <span class="kwrd">new</span> <span class="userclass">SchoolContext</span>();
context.Students.Add(student);

DisplayStates(context.ChangeTracker.Entries());
</pre>
    <div class="outputLabel">
        Output:
    </div>

    <samp>
        Entity: Student, State: Added       <br/>
        Entity: StudentAddress, State: Added<br/>
        Entity: StudentCourse, State: Added <br/>
        Entity: Course, State: Added        <br/>
        Entity: StudentCourse, State: Added <br/>
        Entity: Course, State: Added
    </samp>

    <p>
        The following table lists possible EntityState of each entity in a graph using the <code>DbContext.Add</code> or <code>DbSet.Add</code> methods.
    </p>

    <div class="table-responsive">
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th>Method
                    </th>
                    <th>Root entity with/out Key value
                    </th>
                    <th>Child Entities with/out Key value
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>DbContext.Add(entityGraph) or DbSet.Add(entityGraph)
                    </td>
                    <td>Added
                    </td>
                    <td>Added
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    
<div class="inart-ad">
   
    
</div>


    <h2 id="update-ef-core">Update()</h2>

    <p>
        The <code>DbContext.Update()</code> and <code>DbSet.Update()</code> methods attach an entity graph to a context and set the <code>EntityState</code> of each entity in a graph depending on whether it contains a key property value or not. Consider the following example.
    </p>

    <pre class="csharpcode">
<span class="kwrd">var</span> student = <span class="kwrd">new</span> Student() { <span class="rem">//Root entity (with key value)</span>
    StudentId = 1,
    Name = <span class="str">"Bill"</span>,
    Address = <span class="kwrd">new</span> StudentAddress()  <span class="rem">//Child entity (with key value)</span>
    {
        StudentAddressId = 1,
        City = <span class="str">"Seattle"</span>,
        Country = <span class="str">"USA"</span>
    },
    StudentCourses = <span class="kwrd">new</span> List&lt;StudentCourse&gt;() {
            <span class="kwrd">new</span> StudentCourse(){  Course = <span class="kwrd">new</span> Course(){ CourseName=<span class="str">"Machine Language"</span> } },<span class="rem">//Child entity (empty key)</span>
            <span class="kwrd">new</span> StudentCourse(){  Course = <span class="kwrd">new</span> Course(){  CourseId=2 } } <span class="rem">//Child entity (with key value)</span>
        }
};

<span class="kwrd">var</span> context = <span class="kwrd">new</span> <span class="userclass">SchoolContext</span>();
context.Update(student);

DisplayStates(context.ChangeTracker.Entries());
</pre>
    <div class="outputLabel">
        Output:
    </div>

    <samp>
        Entity: Student, State: Modified        <br/>
        Entity: StudentAddress, State: Modified <br/>
        Entity: StudentCourse, State: Added     <br/>
        Entity: Course, State: Added            <br/>
        Entity: StudentCourse, State: Added     <br/>
        Entity: Course, State: Modified
    </samp>

    <p>
        In the above example, the <code>Update()</code> method applies the Modified state to the entities which contain non-empty key property values and the Added state to those which contain empty or default CLR key values, irrespective of whether they are a root entity or a child entity.
    </p>

    <div class="table-responsive">
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th>Update()
                    </th>
                    <th>Root entity with Key value
                    </th>
                    <th>Root Entity with Empty or CLR default value
                    </th>
                    <th>Child Entities with Key value
                    </th>
                    <th>Child Entities with Empty Key value
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>DbContext.Update(entityGraph) or DbSet.Update(entityGraph)
                    </td>
                    <td>Modified
                    </td>
                    <td>Added
                    </td>
                    <td>Modified
                    </td>
                    <td>Added
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <h2 id="remove-ef-core">Remove()</h2>

    <p>
        The <code>DbContext.Remove()</code> and <code>DbSet.Remove()</code> methods set the Deleted <code>EntityState</code> to the root entity.
    </p>

<pre class="csharpcode">
<span class="kwrd">var</span> student = <span class="kwrd">new</span> Student() { <span class="rem">//Root entity (with key value)</span>
    StudentId = 1,
    Name = <span class="str">"Bill"</span>,
    Address = <span class="kwrd">new</span> StudentAddress()  <span class="rem">//Child entity (with key value)</span>
    {
        StudentAddressId = 1,
        City = <span class="str">"Seattle"</span>,
        Country = <span class="str">"USA"</span>
    },
    StudentCourses = <span class="kwrd">new</span> List&lt;StudentCourse&gt;() {
            <span class="kwrd">new</span> StudentCourse(){  Course = <span class="kwrd">new</span> Course(){ CourseName=<span class="str">"Machine Language"</span> } },<span class="rem">//Child entity (empty key)</span>
            <span class="kwrd">new</span> StudentCourse(){  Course = <span class="kwrd">new</span> Course(){  CourseId=2 } } <span class="rem">//Child entity (with key value)</span>
        }
};

<span class="kwrd">var</span> context = <span class="kwrd">new</span> <span class="userclass">SchoolContext</span>();
context.Remove(student);

DisplayStates(context.ChangeTracker.Entries());
</pre>
    <div class="outputLabel">
        Output:
    </div>

    <samp>
        Entity: Student, State: Deleted         <br/>
        Entity: StudentAddress, State: Unchanged<br/>
        Entity: StudentCourse, State: Added     <br/>
        Entity: Course, State: Added            <br/>
        Entity: StudentCourse, State: Added     <br/>
        Entity: Course, State: Unchanged
    </samp>

    <p>
        The following table lists the behaviour of the <code>Remove()</code> method on the <code>EntityState</code> of each entity.
    </p>

    <div class="table-responsive">
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <th>Remove()
                    </th>
                    <th>Root entity with Key value
                    </th>
                    <th>Root Entity with Empty or CLR default value
                    </th>
                    <th>Child Entities with Key value
                    </th>
                    <th>Child Entities with Empty Key value
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>DbContext.Remove(entityGraph) or DbSet.Remove(entityGraph)
                    </td>
                    <td>Deleted
                    </td>
                    <td>Exception
                    </td>
                    <td>Unchanged
                    </td>
                    <td>Added
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>
        Thus, be careful while using the above methods in EF Core.
    </p>

    <p>
        Learn about the <code>ChangeTracker.TrackGraph()</code> method to deal with each entity in an entity graph in the next chapter.
    </p>



                        
<div class="row">
    <hr />
    
    
    <div class="col-xl-12 text-center">
       <div id="124859-19"><script src="http://ads.themoneytizer.com/s/gen.js?type=19"></script><script src="http://ads.themoneytizer.com/s/requestform.js?siteId=124859&amp;formatId=19"></script></div>
    </div>

</div>

                        
<div class="navigation ">
    <div class="row">
        <div class="col-6  text-left mb-2 mb-sm-0" id="divPrev1">
            <a id="ctl00_eftNextPrevious1_lnkPrev1" class="btn  rounded-0" href="shadow-property.aspx.html"><i class="fa fa-angle-left mr-1"></i> Previous</a>
        </div>
        <div class="col-6 text-right float-right" id="divNext1">
            <a id="ctl00_eftNextPrevious1_lnkNext1" class="btn rounded-0" href="changetracker-trackgraph-ef-core.aspx.html">Next <i class="fa fa-angle-right ml-1"></i></a>
        </div>
    </div>
</div>

                    </div>
                    
                    
<div class=" d-none d-xl-block col-xl-4 rightSidebar">
    <div class="row">
        <div class="col-12">
            <div class="popular-articles col-12">
                <ul class="list-group article-items one">
                    
                    <li class="list-group-item intro"><a href="https://entityframework-extensions.net/fastest-way-to-insert?z=eft-tl" onclick="_gaq.push(['_trackEvent', 'ef_ext_tl', 'click', 'LINK CLICK', 1, true]);" target="_blank" rel="nofollow  noreferrer" title="Improve EF performance using Entity Framework Extension">Fastest Way to Insert using EF Extensions</a></li>
                    <li class="list-group-item intro"><a href="https://www.tutorialsteacher.com" target="_blank" title="C#, ASP.NET MVC, LINQ, TypeScript, Node.js, TypeScirpt">Learn C#, MVC, ASP.NET Core, LINQ</a></li>

                </ul>
            </div>

            
            <div class="mt-3 ml-2">
                <div id="124859-2">
                    <script src="http://ads.themoneytizer.com/s/gen.js?type=2"></script>
                    <script src="http://ads.themoneytizer.com/s/requestform.js?siteId=124859&amp;formatId=2"></script>
                </div>
            </div>
            
            
            
            
            
            <div class="mt-3 ml-2" id="stickyAdDiv">
                <div id="124859-3"><script src="http://ads.themoneytizer.com/s/gen.js?type=3"></script><script src="http://ads.themoneytizer.com/s/requestform.js?siteId=124859&amp;formatId=3"></script></div>
            </div>
        </div>


    </div>
</div>

                </div>
            </div>
            
<footer class="section footer pt-5">
    <div class="footer-main">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-7">
                    <div class="row">
                        <div class="col-md-5 ">
                            <div class="edugate-widget widget">
                                <div class="title-widget">EntityFrameworkTutorial</div>
                                <div class="content-widget">
                                    <p>
                                        Learn Entity Framework using simple yet practical examples on EntityFrameworkTutorial.net for free.
                                        Learn Entity Framework DB-First, Code-First and EF Core step by step.
                                        While using this site, you agree to have read and accepted our terms
                                        of use and <a href="../privacy-policy.aspx.html" class="privacypolicy">privacy policy</a>.
                                    </p>
                                    <div class="info-list">
                                        <ul class="list-unstyled">
                                            <li><i class="fa fa-envelope-o"></i><a class="mail" href="../cdn-cgi/l/email-protection.html#0d6b6868696f6c6e664d6863796479746b7f6c60687a627f66797879627f646c6123636879"><span class="__cf_email__" data-cfemail="88eeededeceae9ebe3c8ede6fce1fcf1eefae9e5edffe7fae3fcfdfce7fae1e9e4a6e6edfc">[email&#160;protected]</span></a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-7">
                            <div class="useful-link-widget widget">
                                <div class="title-widget">Tutorials</div>
                                <div class="content-widget">
                                    <div class="useful-link-list">
                                        <div class="row">
                                            <div class="col-md-6 col-sm-6">
                                                <ul class="list-unstyled">
                                                    <li><i class="fa fa-angle-right"></i><a href="../basics/what-is-entity-in-entityframework.aspx.html">EF Basics</a></li>
                                                    <li><i class="fa fa-angle-right"></i><a href="entity-framework-core.aspx.html">EF Core</a></li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6 col-sm-6 ">
                                                <ul class="list-unstyled">
                                                    <li><i class="fa fa-angle-right"></i><a href="../entityframework6/introduction.aspx.html">EF 6 DB-First</a></li>
                                                    <li><i class="fa fa-angle-right"></i><a href="../code-first/what-is-code-first.aspx.html">EF 6 Code-First</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="row">
                        <div class="col-md-12 ">
                            <div class="mailing-widget widget">
                                <div class="title-widget">E-mail list</div>
                                <div class="content-wiget">
                                    <p>
                                        Subscribe to EntityFrameworkTutorial email list and get EF 6 and EF Core Cheat Sheets, latest updates, tips &amp;
                                        tricks about Entity Framework to your inbox.
                                    </p>
                                    <form action="http://entityframeworktutorial.us13.list-manage.com/subscribe/post-json?u=659e2cbd2829799e7dc94ae35&amp;id=93dae2ea03" method="post" id="subscribe-form" name="subscribe-form" class="validate" novalidate>
                                        <div class="input-group">
                                            <input type="text" placeholder="Email address" class="form-control form-email-widget" name="MERGE0" id="MERGE0" size="25" /><span class="input-group-btn"><input type="submit" value="Go" name="subscribe" id="mc-embedded-subscribe" class="btn btn-email" /></span>
                                        </div>

                                        <div id="mce-responses" class="clear">
                                            <div class="response" id="mce-error-response" style="display: none"></div>
                                            <div class="response" id="mce-success-response" style="display: none"></div>
                                        </div>
                                        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                                        <div style="position: absolute; left: -5000px;" aria-hidden="true">
                                            <input type="text" name="b_659e2cbd2829799e7dc94ae35_93dae2ea03" tabindex="-1" value="" />
                                        </div>
                                        <div class="alert-success" id="successMsg"></div>
                                        <div class="alert-danger" id="failMsg"></div>

                                    </form>
                                    <p>We respect your privacy.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row hyperlink text-center text-md-left">
                <div class="col-md-6 hyper-left">
                    <ul class="list-inline">
                        <li class="list-inline-item"><a href="../aboutme.aspx.html">ABOUT ME</a></li>
                        <li class="list-inline-item"><a href="../privacy-policy.aspx.html">PRIVACY POLICY</a></li>
                        <li class="list-inline-item"><a href="../terms-of-use.aspx.html">TERMS OF USE</a></li>
                    </ul>
                </div>
                <div class="col-md-6 hyper-right text-center text-md-right">
                    <i class="fa fa-copyright" aria-hidden="true"></i> 2023 EntityFrameworkTutorial.net. All Rights Reserved.
                </div>
            </div>
        </div>
    </div>
    
</footer>
   <div id="124859-6"><script data-cfasync="false" src="../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="http://ads.themoneytizer.com/s/gen.js?type=6"></script><script src="http://ads.themoneytizer.com/s/requestform.js?siteId=124859&amp;formatId=6"></script></div>

        </section>
    </div>
    <script src="../scripts/jquery.min.js"></script>
    
    <script src="../scripts/popper.1.12.9.min.js"></script>
    <script src="../App_Themes/bs/bootstrap.min.js"></script>
    <script src="http://www.entityframeworktutorial.net/scripts/eftGeneralScript.min.js?v=1.3"></script>
    <script type="text/javascript" src="http://cdn.pubguru.com/fb.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            stickTLMenus();
            stickyAd();
            var temp = $(window).height();

            $('#back-top a').addClass('d-none');
            $(window).scroll(function () {
                stickTLMenus();
                stickyAd();

                if ($(window).scrollTop() > temp) {
                    $('#back-top a').addClass('d-block');
                    $('#back-top a').removeClass('d-none');
                }
                else {
                    $('#back-top a').addClass('d-none');
                    $('#back-top a').removeClass('d-block');
                }
            });
            var path = $(location).attr('pathname');
            $('#leftmenu li a[href="' + path + '"]').addClass('active');
            $('#topMenu ul li a[href="/efcore/entity-framework-core.aspx"]').addClass('active');

            maintainLeftMenuPos();
            $("#subscribe-form").on("submit", function (s) { s.preventDefault(), submitSubscribeForm($("#subscribe-form")) })
        });
    </script>
</body>
</html>
